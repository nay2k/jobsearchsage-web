{"version":3,"file":"index.js","sources":["../../../src/components/plotband/index.ts"],"sourcesContent":["import { Selection } from 'd3-selection'\n\n// Utils\nimport { smartTransition } from 'utils/d3'\n\n// Core\nimport { XYComponentCore } from 'core/xy-component'\nimport { AxisType } from 'components/axis/types'\n\n// Config\nimport { VERTICAL_X, HORIZONTAL_X, VERTICAL_Y, HORIZONTAL_Y } from './constants'\nimport { PlotbandDefaultConfig, PlotbandConfigInterface } from './config'\nimport { PlotbandLabelOrientation, PlotbandLabelPosition, PlotbandLabelLayout } from './types'\n\n// Styles\nimport * as s from './style'\n\nexport class Plotband<Datum> extends XYComponentCore<Datum, PlotbandConfigInterface<Datum>> {\n  static selectors = s\n  protected _defaultConfig = PlotbandDefaultConfig as PlotbandConfigInterface<Datum>\n  from: number | null | undefined\n  to: number | null | undefined\n  plotband: Selection<SVGRectElement, unknown, null, undefined>\n  label: Selection<SVGTextElement, unknown, null, undefined>\n\n  constructor (config: PlotbandConfigInterface<Datum>) {\n    super()\n    if (config) this.setConfig(config)\n\n    this.plotband = this.g.append('rect')\n      .attr('class', s.plotband)\n\n    this.label = this.g\n      .append('text')\n      .attr('class', s.label)\n  }\n\n  _render (customDuration?: number): void {\n    super._render(customDuration)\n    const { config } = this\n    this.from = config.from\n    this.to = config.to\n\n    this.plotband\n      .style('fill', config.color)\n\n    if (this.from == null || this.to == null) return\n\n    let x = 0\n    let y = 0\n    let width = 0\n    let height = 0\n\n    if (config.axis === 'y') {\n      const y1 = this.yScale(this.from)\n      const y2 = this.yScale(this.to)\n      y = Math.min(y1, y2)\n      height = Math.abs(y1 - y2)\n      x = 0\n      width = this._width\n    } else {\n      const x1 = this.xScale(this.from)\n      const x2 = this.xScale(this.to)\n      x = Math.min(x1, x2)\n      width = Math.abs(x1 - x2)\n      y = 0\n      height = this._height\n    }\n\n    smartTransition(this.plotband, config.duration)\n      .attr('x', x)\n      .attr('y', y)\n      .attr('width', width)\n      .attr('height', height)\n\n    if (config.labelText) {\n      const labelProps = this.computeLabel(\n        config.axis,\n        x,\n        y,\n        width,\n        height,\n        config.labelPosition,\n        config.labelOffsetX,\n        config.labelOffsetY,\n        config.labelOrientation\n      )\n\n      this.label\n        .attr('dominant-baseline', labelProps.dominantBaseline)\n        .attr('transform', labelProps.transform)\n        .style('text-anchor', labelProps.textAnchor)\n        .style('fill', config.labelColor)\n        .style('font-size', config.labelSize ? `${config.labelSize}px` : undefined)\n\n      smartTransition(this.label, config.duration)\n        .text(config.labelText)\n        .attr('x', labelProps.x)\n        .attr('y', labelProps.y)\n    }\n\n    smartTransition(this.plotband.exit())\n      .style('opacity', 0)\n      .remove()\n  }\n\n  private computeLabel (\n    axis: AxisType,\n    startX: number,\n    startY: number,\n    width: number,\n    height: number,\n    position: PlotbandLabelPosition,\n    offsetX: number,\n    offsetY: number,\n    orientation: PlotbandLabelOrientation\n  ): PlotbandLabelLayout {\n    const isVertical = orientation === 'vertical'\n    const rotation = isVertical ? -90 : 0\n    const args = { startX, startY, width, height, offsetX, offsetY }\n\n    let layoutPartial: Omit<PlotbandLabelLayout, 'rotation' | 'transform'>\n\n    if (axis === AxisType.X) {\n      layoutPartial = (isVertical ? VERTICAL_X : HORIZONTAL_X)[position](args)\n    } else {\n      layoutPartial = (isVertical ? VERTICAL_Y : HORIZONTAL_Y)[position](args)\n    }\n\n    const { x, y, textAnchor, dominantBaseline } = layoutPartial\n    const transform = rotation !== 0 ? `rotate(${rotation}, ${x}, ${y})` : ''\n\n    return { x, y, rotation, textAnchor, transform, dominantBaseline }\n  }\n}\n"],"names":["s.plotband","s.label","s"],"mappings":"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"}